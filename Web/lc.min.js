!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).LC={})}(this,(function(t){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,n)};function n(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var r=function(){return(r=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var o in e=arguments[n])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function o(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))}function i(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}}function s(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),o=0;for(e=0;e<n;e++)for(var i=arguments[e],s=0,a=i.length;s<a;s++,o++)r[o]=i[s];return r}var a=null;function u(t){if(a)throw new Error("Adapters already set");a=t}function c(){if(!a)throw new Error("Adapters not set");return a}var h="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function p(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function l(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==e&&n.path)}},n.exports),n.exports}var d=1e3,f=60*d,y=60*f,v=24*y,b=7*v,m=365.25*v,_=function(t,e){e=e||{};var n=typeof t;if("string"===n&&t.length>0)return function(t){if((t=String(t)).length>100)return;var e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!e)return;var n=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*m;case"weeks":case"week":case"w":return n*b;case"days":case"day":case"d":return n*v;case"hours":case"hour":case"hrs":case"hr":case"h":return n*y;case"minutes":case"minute":case"mins":case"min":case"m":return n*f;case"seconds":case"second":case"secs":case"sec":case"s":return n*d;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}(t);if("number"===n&&isFinite(t))return e.long?function(t){var e=Math.abs(t);if(e>=v)return g(t,e,v,"day");if(e>=y)return g(t,e,y,"hour");if(e>=f)return g(t,e,f,"minute");if(e>=d)return g(t,e,d,"second");return t+" ms"}(t):function(t){var e=Math.abs(t);if(e>=v)return Math.round(t/v)+"d";if(e>=y)return Math.round(t/y)+"h";if(e>=f)return Math.round(t/f)+"m";if(e>=d)return Math.round(t/d)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function g(t,e,n,r){var o=e>=1.5*n;return Math.round(t/n)+" "+r+(o?"s":"")}var w=function(t){function e(t){let e=0;for(let n=0;n<t.length;n++)e=(e<<5)-e+t.charCodeAt(n),e|=0;return n.colors[Math.abs(e)%n.colors.length]}function n(t){let i;function s(...t){if(!s.enabled)return;const e=s,r=Number(new Date),o=r-(i||r);e.diff=o,e.prev=i,e.curr=r,i=r,t[0]=n.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let a=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,(r,o)=>{if("%%"===r)return r;a++;const i=n.formatters[o];if("function"==typeof i){const n=t[a];r=i.call(e,n),t.splice(a,1),a--}return r}),n.formatArgs.call(e,t);(e.log||n.log).apply(e,t)}return s.namespace=t,s.enabled=n.enabled(t),s.useColors=n.useColors(),s.color=e(t),s.destroy=r,s.extend=o,"function"==typeof n.init&&n.init(s),n.instances.push(s),s}function r(){const t=n.instances.indexOf(this);return-1!==t&&(n.instances.splice(t,1),!0)}function o(t,e){const r=n(this.namespace+(void 0===e?":":e)+t);return r.log=this.log,r}function i(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return n.debug=n,n.default=n,n.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},n.disable=function(){const t=[...n.names.map(i),...n.skips.map(i).map(t=>"-"+t)].join(",");return n.enable(""),t},n.enable=function(t){let e;n.save(t),n.names=[],n.skips=[];const r=("string"==typeof t?t:"").split(/[\s,]+/),o=r.length;for(e=0;e<o;e++)r[e]&&("-"===(t=r[e].replace(/\*/g,".*?"))[0]?n.skips.push(new RegExp("^"+t.substr(1)+"$")):n.names.push(new RegExp("^"+t+"$")));for(e=0;e<n.instances.length;e++){const t=n.instances[e];t.enabled=n.enabled(t.namespace)}},n.enabled=function(t){if("*"===t[t.length-1])return!0;let e,r;for(e=0,r=n.skips.length;e<r;e++)if(n.skips[e].test(t))return!1;for(e=0,r=n.names.length;e<r;e++)if(n.names[e].test(t))return!0;return!1},n.humanize=_,Object.keys(t).forEach(e=>{n[e]=t[e]}),n.instances=[],n.names=[],n.skips=[],n.formatters={},n.selectColor=e,n.enable(n.load()),n},C=l((function(t,e){e.log=function(...t){return"object"==typeof console&&console.log&&console.log(...t)},e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;e.splice(1,0,n,"color: inherit");let r=0,o=0;e[0].replace(/%[a-zA-Z%]/g,t=>{"%%"!==t&&(r++,"%c"===t&&(o=r))}),e.splice(o,0,n)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&"undefined"!=typeof process&&"env"in process&&(t=process.env.DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.exports=w(e);const{formatters:n}=t.exports;n.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}})),T=function(){function t(){}return Object.defineProperty(t,"enabled",{get:function(){return t._enabled},enumerable:!1,configurable:!0}),Object.defineProperty(t,"filter",{get:function(){return t._filter},enumerable:!1,configurable:!0}),t.enable=function(e){t._enabled=!0,t._filter=e,C.enable(e),t._onEnable.forEach((function(t){return t(e)}))},t.disable=function(){t._enabled=!1,C.disable(),t._onDisable.forEach((function(t){return t()}))},t.log=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];t._getLogger(e).apply(void 0,n)},t.on=function(e,n){switch(e){case"enable":t._onEnable.push(n);break;case"disable":t._onDisable.push(n)}},t._getLogger=function(e){return t._logger[e]||(t._logger[e]=C(e)),t._logger[e]},t._enabled=!1,t._logger={},t._onEnable=[],t._onDisable=[],t}(),O="CURRENT_USER";function k(t){return o(this,void 0,void 0,(function(){var e,n,o,s;return i(this,(function(i){switch(i.label){case 0:return e=c().request,n=A(t),T.log("LC:Request:send","%O",t),s=E,[4,e(n,r(r({},t.options),{method:t.method||"GET",headers:t.header,data:t.body}))];case 1:return o=s.apply(void 0,[i.sent()]),T.log("LC:Request:recv","%O",o),[2,o]}}))}))}function A(t){if(!t.baseURL)throw new Error("Cannot send request: the baseURL is empty");var e=t.baseURL;t.path&&("/"===t.path[0]?e+=t.path:e+="/"+t.path);var n=function(t){var e="";return t&&Object.entries(t).forEach((function(t){var n=t[0],r=t[1];null!=r&&(e&&(e+="&"),e+=n+"="+encodeURIComponent(r))})),e}(t.query);return n&&(e+="?"+n),e}function E(t){return{status:t.status,header:t.headers,body:t.data}}function S(){var t="LeanCloud-JS-SDK/5.0.0-dev",e=c().platformInfo;if(e){var n=e.name,r=e.version;if(n)return r?t+" ("+n+"/"+r+")":t+" ("+n+")"}return t}function j(t){if(t.async)throw new TypeError("The adapters provides an async storage, please use async method instead")}var P={set:function(t,e){var n=c().storage;j(n),t="LC:"+t,n.setItem(t,e),T.log("LC:KV:set","%s = %o",t,e)},get:function(t){var e=c().storage;j(e),t="LC:"+t;var n=e.getItem(t);return T.log("LC:KV:get","%s = %o",t,n),n},delete:function(t){var e=c().storage;j(e),t="LC:"+t,e.removeItem(t),T.log("LC:KV:rm",t)},setAsync:function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=c().storage,t="LC:"+t,[4,n.setItem(t,e)];case 1:return r.sent(),T.log("LC:KV:set","%s = %o",t,e),[2]}}))}))},getAsync:function(t){return o(this,void 0,void 0,(function(){var e,n;return i(this,(function(r){switch(r.label){case 0:return e=c().storage,t="LC:"+t,[4,e.getItem(t)];case 1:return n=r.sent(),T.log("LC:KV:get","%s = %o",t,n),[2,n]}}))}))},deleteAsync:function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return e=c().storage,t="LC:"+t,[4,e.removeItem(t)];case 1:return n.sent(),T.log("LC:KV:rm",t),[2]}}))}))}};function x(t,e){return Object.prototype.toString.call(t)==="[object "+e+"]"}function q(t){return x(t,"Object")}function I(t){return!t||0===Object.keys(t).length}function N(t,e){if(!t)throw new Error(e||"Assertion failed")}var R=function(){function t(){this.data={}}return t.getSubjectId=function(t){return"string"==typeof t?t:t.ACLKey},t.fromJSON=function(e){var n=new t;return Object.entries(e).forEach((function(t){var e=t[0],r=t[1];!0===r.read?n.allow(e,"read"):!1===r.read&&n.deny(e,"read"),!0===r.write?n.allow(e,"write"):!1===r.write&&n.deny(e,"write")})),n},t.allowAllTo=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=new t;return e.forEach((function(t){r.allow(t,"read"),r.allow(t,"write")})),r},t.prototype.allow=function(e,n){var r=t.getSubjectId(e);return this.data[r]||(this.data[r]={}),this.data[r][n]=!0,this},t.prototype.allowRole=function(t,e){return"string"==typeof t&&(t="role:"+t),this.allow(t,e)},t.prototype.deny=function(e,n){var r=t.getSubjectId(e);return this.data[r]&&(delete this.data[r][n],I(this.data[r])&&delete this.data[r]),this},t.prototype.denyRole=function(t,e){return"string"==typeof t&&(t="role:"+t),this.allow(t,e)},t.prototype.can=function(e,n){var r=t.getSubjectId(e);return!(!this.data[r]||!this.data[r][n])},t.prototype.toJSON=function(){return this.data},t}();function U(t){var e=r({},t);return["objectId","createdAt","updatedAt"].forEach((function(t){return delete e[t]})),e}var L=function(){function t(t,e,n){this.app=t,this.className=e,this.objectId=n}return t.prototype.toPointer=function(){return{__type:"Pointer",className:this.className,objectId:this.objectId}},t.prototype.get=function(t){var e,n;return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"GET",path:"1.1/classes/"+this.className+"/"+this.objectId,query:{keys:null===(e=null==t?void 0:t.keys)||void 0===e?void 0:e.join(","),include:null===(n=null==t?void 0:t.include)||void 0===n?void 0:n.join(","),returnACL:null==t?void 0:t.returnACL},options:t})];case 1:if(I((r=o.sent()).body))throw new Error("The objectId '"+this.objectId+"' is not exists");return[2,F.decodeObject(this.app,r.body,this.className)]}}))}))},t.prototype.update=function(t,e){var n;return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/classes/"+this.className+"/"+this.objectId,body:F.encode(U(t)),query:{fetchWhenSave:null==e?void 0:e.fetch,where:null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.toString()},options:e})];case 1:return r=o.sent(),[2,F.decodeObject(this.app,r.body,this.className)]}}))}))},t.prototype.delete=function(t){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.app.request({method:"DELETE",path:"1.1/classes/"+this.className+"/"+this.objectId,options:t})];case 1:return e.sent(),[2]}}))}))},t}(),D=function(){function t(t,e,n){this._ref=new L(t,e,n)}return t.extractData=function(e){if(!e)return e;if("string"==typeof e.className&&"string"==typeof e.objectId&&e.data)return t.extractData(e.data);if(Array.isArray(e))return e.map((function(e){return t.extractData(e)}));if(q(e)){var n={};return Object.entries(e).forEach((function(e){var r=e[0],o=e[1];return n[r]=t.extractData(o)})),n}return e},Object.defineProperty(t.prototype,"app",{get:function(){return this._ref.app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"className",{get:function(){return this._ref.className},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"objectId",{get:function(){return this._ref.objectId},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this.objectId},enumerable:!1,configurable:!0}),t.prototype.toPointer=function(){return this._ref.toPointer()},t.prototype.get=function(t){return this._ref.get(t)},t.prototype.update=function(t,e){return this._ref.update(t,e)},t.prototype.delete=function(t){return this._ref.delete(t)},t.prototype.toJSON=function(){var e=t.extractData(this);return e.objectId=this.objectId,this.createdAt&&(e.createdAt=this.createdAt),this.updatedAt&&(e.updatedAt=this.updatedAt),e},t}(),F=function(){function t(){}return t.setCreator=function(e,n){t._creators.set(e,n)},t.create=function(e,n,r){var o=t._creators.get(n);return o?o(e,r,n):new D(e,n,r)},t.encode=function(e,n){if(!e)return e;if(e instanceof L)return e.toPointer();if(e instanceof D)return t.encodeObject(e,n);if(e instanceof R)return e.toJSON();if(x(e,"Date"))return{__type:"Date",iso:e.toISOString()};if(Array.isArray(e))return e.map((function(e){return t.encode(e)}));if(q(e)){var r={};return Object.entries(e).forEach((function(e){var n=e[0],o=e[1];r[n]=t.encode(o)})),r}return e},t.encodeObject=function(e,n){if(!n)return e.toPointer();var r=t.encode(e.data,n);return r.__type="Object",r.className=e.className,r.objectId=e.objectId,e.createdAt&&(r.createdAt=e.createdAt.toISOString()),e.updatedAt&&(r.updatedAt=e.updatedAt.toISOString()),r},t.decode=function(e,n,r){if(!n)return n;switch(n.__type){case"Pointer":case"Object":return t.decodeObject(e,n,r);case"Date":return new Date(n.iso);case"File":return n.className="_File",t.decodeObject(e,n,r)}if(r)return t.decodeObject(e,n,r);if(Array.isArray(n))return n.map((function(n){return t.decode(e,n)}));if(q(n)){var o={};return Object.entries(n).forEach((function(n){var r=n[0],i=n[1];o[r]=t.decode(e,i)})),o}return n},t.decodeObject=function(e,n,o){o||(o=n.className),N(o,"Decode failed: the className is empty"),N(n.objectId,"Decode failed: the objectId is empty");var i=t.create(e,o,n.objectId),s=r({},n);return["className","objectId","ACL","__type"].forEach((function(t){return delete s[t]})),i.data=t.decode(e,s),["createdAt","updatedAt"].forEach((function(t){n[t]&&(i[t]=new Date(n[t]),delete i.data[t])})),n.ACL&&(i.data.ACL=R.fromJSON(n.ACL)),i},t._creators=new Map,t}(),M=function(t){function e(e,n){var r=t.call(this,"code: "+e+", message: "+n)||this;return r.code=e,r.error=n,r}return n(e,t),e}(Error),B=function(){function t(t){this.app=t}return t.prototype.genKey=function(t){return this.app.appId+":"+t},t.prototype.set=function(t,e){P.set(this.genKey(t),e)},t.prototype.get=function(t){return P.get(this.genKey(t))},t.prototype.delete=function(t){P.delete(this.genKey(t))},t.prototype.setAsync=function(t,e){return P.setAsync(this.genKey(t),e)},t.prototype.getAsync=function(t){return P.getAsync(this.genKey(t))},t.prototype.deleteAsync=function(t){return P.deleteAsync(this.genKey(t))},t}(),$=function(){function t(t){var e;this.useMasterKey=!1,this.appId=t.appId,this.appKey=t.appKey,this.serverURL=t.serverURL,this.masterKey=t.masterKey,this.production=null===(e=t.production)||void 0===e||e,this.kv=new B(this)}return t.prototype.request=function(t){var e,n;return o(this,void 0,void 0,(function(){var r,o,s,a,u,c;return i(this,(function(i){switch(i.label){case 0:return t.baseURL||(t.baseURL=t.baseURL=this.serverURL),t.baseURL!==this.serverURL?[3,4]:(t.header=Object.assign(t.header||{},{"Content-Type":"application/json","X-LC-UA":S(),"X-LC-Id":this.appId,"X-LC-Key":this.appKey}),r=this.useMasterKey,void 0!==(null===(e=t.options)||void 0===e?void 0:e.useMasterKey)&&(r=t.options.useMasterKey),r&&(t.header["X-LC-Key"]=this.masterKey+",master"),o=void 0,(null===(n=t.options)||void 0===n?void 0:n.sessionToken)?(o=t.options.sessionToken,[3,3]):[3,1]);case 1:return[4,this.getSessionTokenAsync()];case 2:o=i.sent(),i.label=3;case 3:o&&(t.header["X-LC-Session"]=o),this.production||(t.header["X-LC-Prod"]="0"),i.label=4;case 4:return[4,k(t)];case 5:if((s=i.sent()).status>=400&&t.baseURL===this.serverURL)throw a=s.body,u=a.code,c=a.error,new M(u,c);return[2,s]}}))}))},t.prototype.decode=function(t,e){return F.decode(this,t,e)},t.prototype.decodeObject=function(t){return F.decodeObject(this,t)},t.prototype.getAdapters=function(){return c()},t.prototype.getLogger=function(){return T},t.prototype.pause=function(){this.realtimeInstance&&this.realtimeInstance.pause()},t.prototype.resume=function(){this.realtimeInstance&&this.realtimeInstance.resume()},t.prototype.getSessionTokenAsync=function(){return o(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return this.currentUser?[2,this.currentUser.sessionToken]:[4,this.kv.getAsync(O)];case 1:return(t=e.sent())?[2,JSON.parse(t).sessionToken]:[2,null]}}))}))},t}();var W=function(t,e){this.__type="GeoPoint","number"==typeof t?(this.latitude=t,this.longitude=e):(this.latitude=t.latitude,this.longitude=t.longitude)},z=function(){function t(t,e){this.app=t,this.className=e,this._where={},this._keys=[],this._order=[],this._include=[]}return t.and=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];N(e.length>1,"The and method require at least 2 queries");for(var r=1;r<e.length;++r)N(e[r].className===e[0].className,"All queries must belongs to same Class"),N(e[r].app.appId===e[0].app.appId,"All queries must belongs to same App");var o=new t(e[0].app,e[0].className);return o._where={$and:e.map((function(t){return t.toJSON()}))},o},t.or=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];N(e.length>1,"The or method require at least 2 queries");var r=t.and.apply(t,e);return r._where.$or=r._where.$and,delete r._where.$and,r},t.prototype.or=function(){if(I(this._where))return this;var e=new t(this.app,this.className);return e._danglingOr=this,e},t.prototype.select=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._clone();return n._keys=t,n},t.prototype.except=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._clone();return n._keys=t.map((function(t){return"-"+t})),n},t.prototype.orderBy=function(t,e){var n=this._clone();return"desc"===e?n._order.push("-"+t):n._order.push(t),n},t.prototype.skip=function(t){var e=this._clone();return e._skip=t,e},t.prototype.limit=function(t){var e=this._clone();return e._limit=t,e},t.prototype.include=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._clone();return n._include=t,n},t.prototype.returnACL=function(t){var e=this._clone();return e._returnACL=t,e},t.prototype.find=function(t){return o(this,void 0,void 0,(function(){var e,n,r=this;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request(this._makeRequest(t))];case 1:return e=o.sent(),[2,null==(n=e.body.results)?void 0:n.map((function(t){return r.app.decode(t,r.className)}))]}}))}))},t.prototype.first=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,this.limit(1).find(t)];case 1:return[2,(e=n.sent()).length?e[0]:null]}}))}))},t.prototype.count=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return(e=this._makeRequest(t)).query.count=1,e.query.limit=0,[4,this.app.request(e)];case 1:return[2,n.sent().body.count]}}))}))},t.prototype.where=function(t,e,n){var r=this._clone();switch(e){case"==":r._whereEqualTo(t,n);break;case"!=":r._whereNotEqualTo(t,n);break;case">":r._whereGreaterThan(t,n);break;case">=":r._whereGreaterThanOrEqualTo(t,n);break;case"<":r._whereLessThan(t,n);break;case"<=":r._whereLessThanOrEqualTo(t,n);break;case"exists":r._whereExists(t);break;case"not-exists":r._whereNotExists(t);break;case"size-is":!function(t){N("number"==typeof t,"Need number, got "+t)}(n),r._whereSizeEqual(t,n);break;case"in":G(n),0==n._keys.length?r._whereMachesQuery(t,n):(N(1===n._keys.length,"The sub-query expect select only one key"),r._whereMatchesKeyInQuery(t,n._keys[0],n));break;case"not-in":G(n),0==n._keys.length?r._whereDoesNotMatchQuery(t,n):(N(1===n._keys.length,"The sub-query expect select only one key"),r._whereDoesNotMatcheKeyInQuery(t,n._keys[0],n));break;case"matches":r._whereMatches(t,n);break;case"starts-with":J(n),r._whereStartsWith(t,n);break;case"ends-with":J(n),r._whereEndsWith(t,n);break;case"contains":if("string"==typeof n)r._whereContains(t,n);else{if(!Array.isArray(n))throw new TypeError("Condition '"+e+"' accepts only string or array value");r._whereContainsAll(t,n)}break;case"contains-any":Q(n),r._whereContainedIn(t,n);break;case"not-contains-any":Q(n),r._whereNotContainedIn(t,n);break;case"near":!function(t){N(t instanceof W,"Need GeoPoint, got "+t)}(n),r._whereNear(t,n);break;case"within":!function(t){var e=t;if("object"==typeof e&&e.northeast instanceof W&&e.southwest instanceof W)return;throw new TypeError("Need GeoBox, got "+t)}(n),r._whereWithinGeoBox(t,n.southwest,n.northeast);break;case"within-radians":H(n),r._whereWithinRadians(t,n.point,n.max,n.min);break;case"within-miles":H(n),r._whereWithinMiles(t,n.point,n.max,n.min);break;case"within-kilometers":H(n),r._whereWithinKilometers(t,n.point,n.max,n.min);break;default:throw new TypeError("Unsupported condition '"+e+"'")}return r},t.prototype.toJSON=function(){if(this._danglingOr){if(I(this._where))return this._danglingOr.toJSON();var e=this._danglingOr;this._danglingOr=null;var n=t.or(e,this).toJSON();return this._danglingOr=e,n}var o=r({},this._where);return Object.entries(o).forEach((function(t){var e=t[0],n=t[1];void 0!==n.$eq&&(o[e]=n.$eq)})),o},t.prototype.toString=function(){return JSON.stringify(this)},t.prototype.subscribe=function(){return N($.LiveQuery,"Query#subscribe need the LiveQuery module"),$.LiveQuery.subscribe(this)},t.prototype._clone=function(e){return e||(e=new t(this.app,this.className)),Object.entries(this._where).forEach((function(t){var n=t[0],o=t[1];Array.isArray(o)?e._where[n]=s(o):e._where[n]=r({},o)})),e._keys=s(this._keys),e._order=s(this._order),e._include=s(this._include),e._skip=this._skip,e._limit=this._limit,e._returnACL=this._returnACL,e._danglingOr=this._danglingOr,e},t.prototype._makeRequest=function(t){var e={path:"1.1/classes/"+this.className,query:{limit:this._limit,skip:this._skip,returnACL:this._returnACL},options:t},n=this.toString();return"{}"!==n&&(e.query.where=n),this._include.length&&(e.query.include=this._include.join(",")),this._order.length&&(e.query.order=this._order.join(",")),this._keys.length&&(e.query.keys=this._keys.join(",")),e},t.prototype._addCondition=function(t,e,n){this._where[t]||(this._where[t]={}),this._where[t][e]=F.encode(n)},t.prototype._clearAllCondition=function(t){this._where[t]&&(this._where[t]={})},t.prototype._whereEqualTo=function(t,e){this._clearAllCondition(t),this._addCondition(t,"$eq",e)},t.prototype._whereNotEqualTo=function(t,e){this._addCondition(t,"$ne",e)},t.prototype._whereGreaterThan=function(t,e){this._addCondition(t,"$gt",e)},t.prototype._whereGreaterThanOrEqualTo=function(t,e){this._addCondition(t,"$gte",e)},t.prototype._whereLessThan=function(t,e){this._addCondition(t,"$lt",e)},t.prototype._whereLessThanOrEqualTo=function(t,e){this._addCondition(t,"$lte",e)},t.prototype._whereExists=function(t){this._addCondition(t,"$exists",!0)},t.prototype._whereNotExists=function(t){this._addCondition(t,"$exists",!1)},t.prototype._whereSizeEqual=function(t,e){this._addCondition(t,"$size",e)},t.prototype._whereMatchesKeyInQuery=function(t,e,n){this._addCondition(t,"$select",{key:e,query:{className:n.className,where:n.toJSON()}})},t.prototype._whereDoesNotMatcheKeyInQuery=function(t,e,n){this._addCondition(t,"$dontSelect",{key:e,query:{className:n.className,where:n.toJSON()}})},t.prototype._whereMachesQuery=function(t,e){this._addCondition(t,"$inQuery",{className:e.className,where:e.toJSON()})},t.prototype._whereDoesNotMatchQuery=function(t,e){this._addCondition(t,"$notInQuery",{className:e.className,where:e.toJSON()})},t.prototype._whereMatches=function(t,e){var n,r="";"string"==typeof e?n=e:(x(e,"RegExp")?n=e.source:(n=e.regexp,e.ignoreBlank&&(r+="x")),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s")),this._addCondition(t,"$regex",n),r&&this._addCondition(t,"$options",r)},t.prototype._whereStartsWith=function(t,e){this._whereMatches(t,"^"+K(e))},t.prototype._whereEndsWith=function(t,e){this._whereMatches(t,K(e)+"$")},t.prototype._whereContains=function(t,e){this._whereMatches(t,K(e))},t.prototype._whereContainsAll=function(t,e){this._addCondition(t,"$all",e)},t.prototype._whereContainedIn=function(t,e){this._addCondition(t,"$in",e)},t.prototype._whereNotContainedIn=function(t,e){this._addCondition(t,"$nin",e)},t.prototype._whereNear=function(t,e){this._addCondition(t,"$nearSphere",e)},t.prototype._whereWithinGeoBox=function(t,e,n){this._addCondition(t,"$within",{$box:[e,n]})},t.prototype._whereWithinRadians=function(t,e,n,r){this._whereNear(t,e),this._addCondition(t,"$maxDistanceInRadians",n),void 0!==r&&this._addCondition(t,"$minDistanceInRadians",r)},t.prototype._whereWithinMiles=function(t,e,n,r){this._whereNear(t,e),this._addCondition(t,"$maxDistanceInMiles",n),void 0!==r&&this._addCondition(t,"$minDistanceInMiles",r)},t.prototype._whereWithinKilometers=function(t,e,n,r){this._whereNear(t,e),this._addCondition(t,"$maxDistanceInKilometers",n),void 0!==r&&this._addCondition(t,"$minDistanceInKilometers",r)},t}();function K(t){return"\\Q"+t.replace("\\E","\\E\\\\E\\Q")+"\\E"}function J(t){N("string"==typeof t,"Need string, got "+t)}function Q(t){N(Array.isArray(t),"Need array, got "+t)}function G(t){N(t instanceof z,"Need Query, got "+t)}function H(t){var e=t;if(!("object"==typeof e&&e.point instanceof W&&"number"==typeof e.max)||void 0!==e.min&&"number"!=typeof e.min)throw new TypeError("Need GeoDistance, got "+t)}var X=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.object=function(t){return new L(this.app,this.className,t)},e.prototype.add=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/classes/"+this.className,body:F.encode(U(t)),query:{fetchWhenSave:null==e?void 0:e.fetch},options:e})];case 1:return n=r.sent(),[2,this.app.decode(n.body,this.className)]}}))}))},e}(z),V=function(){function t(){}return t.unset=function(){return{__op:"Delete"}},t.increment=function(t){return void 0===t&&(t=1),{__op:"Increment",amount:t}},t.decrement=function(t){return void 0===t&&(t=1),{__op:"Decrement",amount:t}},t.add=function(t){return Array.isArray(t)||(t=[t]),{__op:"Add",objects:t}},t.addUnique=function(t){return Array.isArray(t)||(t=[t]),{__op:"AddUnique",objects:t}},t.remove=function(t){return Array.isArray(t)||(t=[t]),{__op:"Remove",objects:t}},t.bitAnd=function(t){return{__op:"BitAnd",value:t}},t.bitOr=function(t){return{__op:"BitOr",value:t}},t.bitXor=function(t){return{__op:"BitXor",value:t}},t.addRelation=function(t){return Array.isArray(t)||(t=[t]),{__op:"AddRelation",objects:t.map((function(t){return t.toPointer()}))}},t.removeRelation=function(e){var n=t.addRelation(e);return n.__op="RemoveRelation",n},t}();F.setCreator("_User",(function(t,e){return new tt(t,e)}));var Z=function(){function t(){}return t.setCurrentUser=function(t,e){var n=F.encode(e,!0);t.kv.set(O,JSON.stringify(n)),t.currentUser=e},t.setCurrentAsync=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return n=F.encode(e,!0),[4,t.kv.setAsync(O,JSON.stringify(n))];case 1:return r.sent(),t.currentUser=e,[2]}}))}))},t.getCurrentUser=function(t){if(!t.currentUser){var e=t.kv.get(O);e&&(t.currentUser=t.decode(JSON.parse(e)))}return t.currentUser},t.getCurrentUserAsync=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return t.currentUser?[3,2]:[4,t.kv.getAsync(O)];case 1:(e=n.sent())&&(t.currentUser=t.decode(JSON.parse(e))),n.label=2;case 2:return[2,t.currentUser]}}))}))},t.removeCurrentUser=function(t){t.kv.delete(O),t.currentUser=null},t.removeCurrentUserAsync=function(t){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,t.kv.deleteAsync(O)];case 1:return e.sent(),t.currentUser=null,[2]}}))}))},t.syncCurrentUser=function(t,e){var n=t.kv.get(O);if(n){var r=JSON.parse(n);e(r),delete r.password,t.kv.set(O,JSON.stringify(r)),t.currentUser=null}},t.syncCurrentUserAsync=function(t,e){return o(this,void 0,void 0,(function(){var n,r;return i(this,(function(o){switch(o.label){case 0:return[4,t.kv.getAsync(O)];case 1:return(n=o.sent())?(r=JSON.parse(n),e(r),delete r.password,[4,t.kv.setAsync(O,JSON.stringify(r))]):[2];case 2:return o.sent(),t.currentUser=null,[2]}}))}))},t}(),Y=function(t){function e(e,n){return t.call(this,e,"_User",n)||this}return n(e,t),Object.defineProperty(e.prototype,"ACLKey",{get:function(){return this.objectId},enumerable:!1,configurable:!0}),e.prototype.isCurrent=function(){var t=Z.getCurrentUser(this.app);return this.objectId===(null==t?void 0:t.objectId)},e.prototype.isCurrentAsync=function(){return o(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return[4,Z.getCurrentUserAsync(this.app)];case 1:return t=e.sent(),[2,this.objectId===(null==t?void 0:t.objectId)]}}))}))},e.prototype.get=function(e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,t.prototype.get.call(this,e)];case 1:return n=r.sent(),[4,this.isCurrentAsync()];case 2:return r.sent()?[4,Z.syncCurrentUserAsync(this.app,(function(t){Object.assign(t,F.encode(n,!0))}))]:[3,4];case 3:r.sent(),r.label=4;case 4:return[2,n]}}))}))},e.prototype.update=function(e,n){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,t.prototype.update.call(this,e,n)];case 1:return r=o.sent(),[4,this.isCurrentAsync()];case 2:return o.sent()?[4,Z.syncCurrentUserAsync(this.app,(function(t){Object.assign(t,e,F.encode(r,!0))}))]:[3,4];case 3:o.sent(),o.label=4;case 4:return[2,r]}}))}))},e.prototype.delete=function(e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,t.prototype.delete.call(this,e)];case 1:return n.sent(),[4,this.isCurrentAsync()];case 2:return n.sent()?[4,Z.removeCurrentUserAsync(this.app)]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},e.prototype.getRoles=function(){return new z(this.app,"_Role").where("users","==",this).find()},e}(L),tt=function(t){function e(e,n){var r=t.call(this,e,"_User",n)||this;return r._ref=new Y(e,n),r}return n(e,t),Object.defineProperty(e.prototype,"sessionToken",{get:function(){return this.data.sessionToken},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ACLKey",{get:function(){return this._ref.ACLKey},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"_anonymousId",{get:function(){var t;return null===(t=this.data.authData.anonymous)||void 0===t?void 0:t.id},enumerable:!1,configurable:!0}),e.prototype.isCurrent=function(){if(this.isAnonymous()){var t=Z.getCurrentUser(this.app);return this._anonymousId===t._anonymousId}return this._ref.isCurrent()},e.prototype.isCurrentAsync=function(){return o(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return this.isAnonymous()?[4,Z.getCurrentUserAsync(this.app)]:[3,2];case 1:return t=e.sent(),[2,this._anonymousId===t._anonymousId];case 2:return[2,this._ref.isCurrentAsync()]}}))}))},e.prototype.isAnonymous=function(){var t;return!!(null===(t=this.data.authData)||void 0===t?void 0:t.anonymous)},e.prototype.isAuthenticated=function(){return o(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.app.request({path:"1.1/users/me",options:{sessionToken:this.sessionToken}})];case 1:return e.sent(),[2,!0];case 2:if(211!==(t=e.sent()).code)throw t;return[2,!1];case 3:return[2]}}))}))},e.prototype.updatePassword=function(t,e,n){return o(this,void 0,void 0,(function(){var o,s=this;return i(this,(function(i){switch(i.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/users/"+this.objectId+"/updatePassword",body:{old_password:t,new_password:e},options:r({sessionToken:this.sessionToken},n)})];case 1:return o=i.sent(),this.data.sessionToken=o.body.sessionToken,[4,this.isCurrentAsync()];case 2:return i.sent()?[4,Z.syncCurrentUserAsync(this.app,(function(t){t.sessionToken=s.sessionToken}))]:[3,4];case 3:i.sent(),i.label=4;case 4:return[2]}}))}))},e.prototype.associateWithAuthData=function(t,e,n){var o;return this.update({authData:(o={},o[t]=e,o)},r({fetch:!0},n))},e.prototype.associateWithAuthDataAndUnionId=function(t,e,n,r){var o,i;return Object.assign(e,{unionid:n,platform:null!==(o=null==r?void 0:r.unionIdPlatform)&&void 0!==o?o:"weixin",main_account:null!==(i=null==r?void 0:r.asMainAccount)&&void 0!==i&&i}),this.associateWithAuthData(t,e,r)},e.prototype.associateWithMiniApp=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,this.app.getAdapters().getAuthInfo(t)];case 1:return e=n.sent(),[2,this.associateWithAuthData(e.provider,e.authData,t)]}}))}))},e.prototype.dissociateAuthData=function(t){var e;return this.update(((e={})["authData."+t]=V.unset(),e),{fetch:!0})},e.prototype.signUp=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:if(!this.isAnonymous())throw new Error("User#signUp can only be invoked by an anonymous user");return N(t.username,"The username must be provided"),N(t.password,"The password must be provided"),[4,this.isCurrentAsync()];case 1:return n.sent()&&Z.syncCurrentUserAsync(this.app,(function(t){delete t.authData.anonymous})),[2,this.update(t,e)]}}))}))},e.prototype.refreshSessionToken=function(t){return o(this,void 0,void 0,(function(){var e,n=this;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/users/"+this.objectId+"/refreshSessionToken",options:r(r({},t),{sessionToken:this.sessionToken})})];case 1:return e=o.sent(),this.data.sessionToken=e.body.sessionToken,[4,this.isCurrentAsync()];case 2:return o.sent()?[4,Z.syncCurrentUserAsync(this.app,(function(t){t.sessionToken=n.sessionToken}))]:[3,4];case 3:o.sent(),o.label=4;case 4:return[2]}}))}))},e.prototype.follow=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(o){switch(o.label){case 0:return N(this.sessionToken,"Cannot create friendship for an unauthorized user"),n="string"==typeof t?t:t.objectId,[4,this.app.request({method:"POST",path:"1.1/users/"+this.objectId+"/friendship/"+n,body:null==e?void 0:e.data,options:r(r({},e),{sessionToken:this.sessionToken})})];case 1:return o.sent(),[2]}}))}))},e.prototype.unfollow=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(o){switch(o.label){case 0:return N(this.sessionToken,"Cannot remove friendship for an unauthorized user"),n="string"==typeof t?t:t.objectId,[4,this.app.request({method:"DELETE",path:"1.1/users/"+this.objectId+"/friendship/"+n,options:r(r({},e),{sessionToken:this.sessionToken})})];case 1:return o.sent(),[2]}}))}))},e.prototype.getRoles=function(){return this._ref.getRoles()},e.prototype.get=function(t){return this._ref.get(r({sessionToken:this.sessionToken},t))},e.prototype.update=function(t,e){return this._ref.update(t,r({sessionToken:this.sessionToken},e))},e.prototype.delete=function(t){return this._ref.delete(r({sessionToken:this.sessionToken},t))},e}(D),et="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto),nt=new Uint8Array(16);function rt(){if(!et)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return et(nt)}var ot=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function it(t){return"string"==typeof t&&ot.test(t)}for(var st=[],at=0;at<256;++at)st.push((at+256).toString(16).substr(1));function ut(t,e,n){var r=(t=t||{}).random||(t.rng||rt)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){n=n||0;for(var o=0;o<16;++o)e[n+o]=r[o];return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(st[t[e+0]]+st[t[e+1]]+st[t[e+2]]+st[t[e+3]]+"-"+st[t[e+4]]+st[t[e+5]]+"-"+st[t[e+6]]+st[t[e+7]]+"-"+st[t[e+8]]+st[t[e+9]]+"-"+st[t[e+10]]+st[t[e+11]]+st[t[e+12]]+st[t[e+13]]+st[t[e+14]]+st[t[e+15]]).toLowerCase();if(!it(n))throw TypeError("Stringified UUID is invalid");return n}(r)}var ct=function(t){function e(e){return t.call(this,e,"_User")||this}return n(e,t),e.prototype.object=function(t){return new Y(this.app,t)},e.prototype.current=function(){return Z.getCurrentUser(this.app)},e.prototype.currentAsync=function(){return Z.getCurrentUserAsync(this.app)},e.prototype.become=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({path:"1.1/users/me",options:r(r({},e),{sessionToken:t})})];case 1:return n=o.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},e.prototype.signUp=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/users",body:U(t),options:e})];case 1:return n=r.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},e.prototype.signUpOrLoginWithMobilePhone=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/usersByMobilePhone",body:U(t),options:e})];case 1:return n=r.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},e.prototype.logInWithData=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/login",body:U(t),options:e})];case 1:return n=r.sent(),[2,this._decodeAndSetToCurrent(n.body)]}}))}))},e.prototype.logIn=function(t,e,n){return this.logInWithData({username:t,password:e},n)},e.prototype.logInWithAuthData=function(t,e,n){return o(this,void 0,void 0,(function(){var r,o;return i(this,(function(i){switch(i.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/users",body:{authData:(o={},o[t]=e,o)},query:{failOnNotExist:null==n?void 0:n.failOnNotExist},options:n})];case 1:return r=i.sent(),[2,this._decodeAndSetToCurrent(r.body)]}}))}))},e.prototype.logInAnonymously=function(t){return this.logInWithAuthData("anonymous",{id:ut()},t)},e.prototype.logInWithEmail=function(t,e,n){return this.logInWithData({email:t,password:e},n)},e.prototype.logInWithMobilePhone=function(t,e,n){return this.logInWithData({mobilePhoneNumber:t,password:e},n)},e.prototype.logInWithMobilePhoneSMSCode=function(t,e,n){return this.logInWithData({mobilePhoneNumber:t,smsCode:e},n)},e.prototype.logInWithAuthDataAndUnionId=function(t,e,n,r){return e=Object.assign({},e,{platform:null==r?void 0:r.unionIdPlatform,main_account:null==r?void 0:r.asMainAccount,unionid:n}),this.logInWithAuthData(t,e,r)},e.prototype.logInWithMiniApp=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,this.app.getAdapters().getAuthInfo(t)];case 1:return e=n.sent(),[2,this.logInWithAuthData(e.provider,e.authData,t)]}}))}))},e.prototype.logOut=function(){Z.removeCurrentUser(this.app)},e.prototype.logOutAsync=function(){return Z.removeCurrentUserAsync(this.app)},e.prototype.requestEmailVerify=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestEmailVerify",body:{email:t},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.requestLoginSMSCode=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestLoginSmsCode",body:{mobilePhoneNumber:t,validate_token:null==e?void 0:e.validateToken},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.requestMobilePhoneVerify=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestMobilePhoneVerify",body:{mobilePhoneNumber:t,validate_token:null==e?void 0:e.validateToken},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.requestPasswordReset=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestPasswordReset",body:{email:t},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.requestPasswordResetBySMSCode=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestPasswordResetBySmsCode",body:{mobilePhoneNumber:t,validate_token:null==e?void 0:e.validateToken},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.resetPasswordBySMSCode=function(t,e,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/resetPasswordBySmsCode/"+t,body:{password:e},options:n})];case 1:return r.sent(),[2]}}))}))},e.prototype.verifyMobilePhone=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/verifyMobilePhone/"+t,options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.requestChangePhoneNumber=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestChangePhoneNumber",body:{mobilePhoneNumber:t,ttl:null==e?void 0:e.ttl},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.changePhoneNumber=function(t,e,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/changePhoneNumber",body:{mobilePhoneNumber:t,code:e},options:n})];case 1:return r.sent(),[2]}}))}))},e.prototype._decodeAndSetToCurrent=function(t){var e=this.app.decode(t,this.className);return Z.setCurrentUser(this.app,e),e},e}(X);F.setCreator("_Role",(function(t,e){return new pt(t,e)}));var ht=function(t){function e(e,n){return t.call(this,e,"_Role",n)||this}return n(e,t),e.prototype.addUser=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/roles/"+this.objectId,body:{users:V.addRelation(t)},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.addRole=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/roles/"+this.objectId,body:{roles:V.addRelation(t)},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.removeUser=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/roles/"+this.objectId,body:{users:V.removeRelation(t)},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.removeRole=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"PUT",path:"1.1/roles/"+this.objectId,body:{roles:V.removeRelation(t)},options:e})];case 1:return n.sent(),[2]}}))}))},e.prototype.getUsersQuery=function(){return new z(this.app,"_User").where("$relatedTo","==",{object:this,key:"users"})},e.prototype.getRolesQuery=function(){return new z(this.app,"_Role").where("$relatedTo","==",{object:this,key:"roles"})},e.prototype.getUsers=function(t){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.getUsersQuery().find(t)];case 1:return[2,e.sent()]}}))}))},e.prototype.getRoles=function(t){return o(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,this.getRolesQuery().find(t)];case 1:return[2,e.sent()]}}))}))},e.prototype.get=function(e){return t.prototype.get.call(this,e)},e.prototype.update=function(e,n){return t.prototype.update.call(this,e,n)},e}(L),pt=function(t){function e(e,n){var r=t.call(this,e,"_Role",n)||this;return r._ref=new ht(e,n),r}return n(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return this.data.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ACLKey",{get:function(){return"role:"+this.data.name},enumerable:!1,configurable:!0}),e.prototype.addUser=function(t,e){return this._ref.addUser(t,e)},e.prototype.addRole=function(t,e){return this._ref.addRole(t,e)},e.prototype.removeUser=function(t,e){return this._ref.removeUser(t,e)},e.prototype.removeRole=function(t,e){return this._ref.removeRole(t,e)},e.prototype.getUsersQuery=function(){return this._ref.getUsersQuery()},e.prototype.getRolesQuery=function(){return this._ref.getRolesQuery()},e.prototype.getUsers=function(t){return this._ref.getUsers(t)},e.prototype.getRoles=function(t){return this._ref.getRoles(t)},e.prototype.get=function(e){return t.prototype.get.call(this,e)},e.prototype.update=function(e,n){return t.prototype.update.call(this,e,n)},e}(D),lt=function(t){function e(e){return t.call(this,e,"_Role")||this}return n(e,t),e.prototype.object=function(t){return new ht(this.app,t)},e.prototype.add=function(t,e){return o(this,void 0,void 0,(function(){var n,o;return i(this,(function(i){switch(i.label){case 0:return n=r({},t),t.roles&&(n.roles=V.addRelation(t.roles)),t.users&&(n.users=V.addRelation(t.users)),[4,this.app.request({method:"POST",path:"1.1/roles",body:n,options:e})];case 1:return o=i.sent(),[2,this.app.decode(o.body,this.className)]}}))}))},e}(X),dt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.sendToFollowers=function(t,e,n){return o(this,void 0,void 0,(function(){var o;return i(this,(function(i){switch(i.label){case 0:return N(t.sessionToken,"Cannot create status for an unauthorized user"),[4,this.app.request({method:"POST",path:"1.1/statuses",query:{fetchWhenSave:!0},body:{query:{className:"_Follower",keys:"follower",where:{user:t.toPointer()}},data:r({source:t.toPointer()},e),inboxType:null==n?void 0:n.inboxType},options:r({sessionToken:t.sessionToken},n)})];case 1:return o=i.sent(),[2,F.decodeObject(this.app,o.body,"_Status")]}}))}))},e.prototype.sendToUser=function(t,e,n,s){return o(this,void 0,void 0,(function(){var o,a;return i(this,(function(i){switch(i.label){case 0:return N(t.sessionToken,"Cannot create status for an unauthorized user"),o="string"==typeof e?e:e.objectId,[4,this.app.request({method:"POST",path:"1.1/statuses",body:{query:{className:"_User",where:{objectId:o}},data:r({source:t.toPointer()},n),inboxType:(null==s?void 0:s.inboxType)||"private"},options:r({sessionToken:t.sessionToken},s)})];case 1:return a=i.sent(),[2,F.decodeObject(this.app,a.body,"_Status")]}}))}))},e.prototype.deleteInboxStatus=function(t,e,n){return o(this,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:return N(t.sessionToken,"Cannot remove status for an unauthorized user"),[4,this.app.request({method:"DELETE",path:"1.1/subscribe/statuses/inbox",query:{owner:JSON.stringify(t.toPointer()),inboxType:null==n?void 0:n.inboxType,messageId:e},options:r({sessionToken:t.sessionToken},n)})];case 1:return o.sent(),[2]}}))}))},e.prototype.getUnreadCount=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return N(t.sessionToken,"Cannot get unread status count for an unauthorized user"),[4,this.app.request({method:"GET",path:"1.1/subscribe/statuses/count",query:{owner:JSON.stringify(t.toPointer()),inboxType:null==e?void 0:e.inboxType},options:r({sessionToken:t.sessionToken},e)})];case 1:return[2,n.sent().body]}}))}))},e.prototype.resetUnreadCount=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return N(t.sessionToken,"Cannot reset unread count for an unauthorized user"),[4,this.app.request({method:"POST",path:"1.1/subscribe/statuses/resetUnreadCount",query:{owner:JSON.stringify(t.toPointer()),inboxType:null==e?void 0:e.inboxType},options:r({sessionToken:t.sessionToken},e)})];case 1:return n.sent(),[2]}}))}))},e}(function(t){function e(e){return t.call(this,e,"_Status")||this}return n(e,t),e.prototype.whereStatusOwner=function(t){var e=this._clone();return e._statusOwner="string"==typeof t?{__type:"Pointer",className:"_User",objectId:t}:t.toPointer(),e._whereEqualTo("source",e._statusOwner),e},e.prototype.whereInboxOwner=function(t){N(t.sessionToken,"Cannot query inbox for an unauthorized user");var e=this._clone();return e._inboxOwner=t,e},e.prototype.whereInboxType=function(t){var e=this._clone();return e._inboxType=t,e},e.prototype.whereSinceId=function(t){var e=this._clone();return e._sinceId=t,e},e.prototype.whereMaxId=function(t){var e=this._clone();return e._maxId=t,e},e.prototype._clone=function(n){return n||(n=new e(this.app)),(n=t.prototype._clone.call(this,n))._statusOwner=this._statusOwner,n._inboxOwner=this._inboxOwner,n._inboxType=this._inboxType,n._sinceId=this._sinceId,n._maxId=this._maxId,n},e.prototype._makeRequest=function(e){var n=t.prototype._makeRequest.call(this,e);return this._inboxOwner&&(N(void 0===this._statusOwner,"Cannot query both inboxOwner and statusOwner"),n.path="1.1/subscribe/statuses",n.options?n.options.sessionToken||(n.options.sessionToken=this._inboxOwner.sessionToken):n.options={sessionToken:this._inboxOwner.sessionToken},n.query.owner=JSON.stringify(this._inboxOwner.toPointer()),n.query.inboxType=this._inboxType,n.query.sinceId=this._sinceId,n.query.maxId=this._maxId),n},e}(z)),ft=l((function(t,e){!function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",n=new Uint8Array(256),r=0;r<t.length;r++)n[t.charCodeAt(r)]=r;e.encode=function(e){var n,r=new Uint8Array(e),o=r.length,i="";for(n=0;n<o;n+=3)i+=t[r[n]>>2],i+=t[(3&r[n])<<4|r[n+1]>>4],i+=t[(15&r[n+1])<<2|r[n+2]>>6],i+=t[63&r[n+2]];return o%3==2?i=i.substring(0,i.length-1)+"=":o%3==1&&(i=i.substring(0,i.length-2)+"=="),i},e.decode=function(t){var e,r,o,i,s,a=.75*t.length,u=t.length,c=0;"="===t[t.length-1]&&(a--,"="===t[t.length-2]&&a--);var h=new ArrayBuffer(a),p=new Uint8Array(h);for(e=0;e<u;e+=4)r=n[t.charCodeAt(e)],o=n[t.charCodeAt(e+1)],i=n[t.charCodeAt(e+2)],s=n[t.charCodeAt(e+3)],p[c++]=r<<2|o>>4,p[c++]=(15&o)<<4|i>>2,p[c++]=(3&i)<<6|63&s;return h}}()})),yt=function(){function t(){}return t.prototype.upload=function(t,e,n,s){return function(t,e){return o(this,void 0,void 0,(function(){var n,o,s,a;return i(this,(function(i){switch(i.label){case 0:return n=c().upload,o=A(t),T.log("LC:Upload:send","%O",t),a=E,[4,n(o,e,r(r({},t.options),{method:t.method||"POST",headers:t.header,data:t.form}))];case 1:return s=a.apply(void 0,[i.sent()]),T.log("LC:Upload:recv","%O",s),[2,s]}}))}))}({method:"POST",header:null==s?void 0:s.header,baseURL:n.upload_url,form:{name:t,key:n.key,token:n.token},options:s},{field:"file",name:t,data:e})},t}(),vt=function(){function t(t){this.app=t}return t.prototype.upload=function(t,e,n,o){return this.app.request({method:"PUT",baseURL:n.upload_url,header:r({"Content-Type":n.mime_type,"Cache-Control":"public, max-age=31536000"},null==o?void 0:o.header),body:e,options:o})},t}();F.setCreator("_File",(function(t,e){return new mt(t,e)}));var bt=function(t){function e(e,n){return t.call(this,e,"_File",n)||this}return n(e,t),e.prototype.get=function(e){return t.prototype.get.call(this,e)},e.prototype.update=function(e,n){return t.prototype.update.call(this,{name:e.name,url:e.url,mime_type:e.mime_type,metaData:e.metaData,ACL:e.ACL},n)},e}(L),mt=function(t){function e(e,n){var r=t.call(this,e,"_File",n)||this;return r._ref=new bt(e,n),r}return n(e,t),Object.defineProperty(e.prototype,"name",{get:function(){return this.data.name},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"url",{get:function(){return this.data.url},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"size",{get:function(){var t;return null===(t=this.data.metaData)||void 0===t?void 0:t.size},enumerable:!1,configurable:!0}),e.prototype.thumbnailURL=function(t,e,n,r,o){void 0===n&&(n=100),void 0===r&&(r=!0),void 0===o&&(o="png");var i=r?2:1;return this.url+"?imageView/"+i+"/w/"+t+"/h/"+e+"/q/"+n+"/format/"+o},e.prototype.get=function(t){return this._ref.get(t)},e.prototype.update=function(t,e){return this._ref.update(t,e)},e}(D),_t=function(t){function e(e){return t.call(this,e,"_File")||this}return n(e,t),e.prototype.object=function(t){return new bt(this.app,t)},e.prototype.upload=function(t,e,n){return o(this,void 0,void 0,(function(){var o,s,a,u,c,h;return i(this,(function(i){switch(i.label){case 0:return e=this._parseFileData(e),o=r(r({},null==n?void 0:n.metaData),{size:this._getFileSize(e)}),(null==n?void 0:n.sessionToken)?(o.owner=n.sessionToken,[3,3]):[3,1];case 1:return s=o,[4,this.app.getSessionTokenAsync()];case 2:s.owner=i.sent(),i.label=3;case 3:return o.owner||(o.owner="unknown"),[4,this._getFileTokens(t,null==n?void 0:n.mime,null==n?void 0:n.ACL,o)];case 4:a=i.sent(),u=this._getFileProvider(a.provider),i.label=5;case 5:return i.trys.push([5,8,,10]),[4,u.upload(t,e,a,n)];case 6:return i.sent(),[4,this._invokeFileCallback(a.token,!0)];case 7:return i.sent(),[3,10];case 8:return c=i.sent(),[4,this._invokeFileCallback(a.token,!1)];case 9:throw i.sent(),c;case 10:return(h=new mt(this.app,a.objectId)).data=r(r({},a),{name:t,metaData:o}),h.createdAt=new Date(a.createdAt),h.updatedAt=h.createdAt,delete h.data.createdAt,[2,h]}}))}))},e.prototype.uploadWithURL=function(t,e,n){return o(this,void 0,void 0,(function(){var o,s,a,u;return i(this,(function(i){switch(i.label){case 0:return o=r(r({},null==n?void 0:n.metaData),{__source:"external"}),(null==n?void 0:n.sessionToken)?(o.owner=n.sessionToken,[3,3]):[3,1];case 1:return s=o,[4,this.app.getSessionTokenAsync()];case 2:s.owner=i.sent(),i.label=3;case 3:return o.owner||(o.owner="unknown"),[4,this.app.request({method:"POST",path:"1.1/files/"+t,body:{name:t,url:e,ACL:null==n?void 0:n.ACL,mime_type:null==n?void 0:n.mime,metaData:o}})];case 4:return a=i.sent(),(u=new mt(this.app,a.body.objectId)).data=r(r({},a.body),{metaData:o}),u.createdAt=new Date(u.data.createdAt),u.updatedAt=u.createdAt,delete u.data.createdAt,[2,u]}}))}))},e.prototype._parseFileData=function(t){if(Array.isArray(t)){var e=new Uint8Array(t.length);if(t.forEach((function(t,n){return e[n]=t})),"undefined"!=typeof Blob)return new Blob([e]);if("undefined"!=typeof Buffer)return Buffer.from(e);throw new Error("Current platform cannot upload byte array encoded file")}if(t.base64){var n=t.base64;if("undefined"!=typeof Blob)return new Blob([ft.decode(n)]);if("undefined"!=typeof Buffer)return Buffer.from(n,"base64");throw new Error("Current platform cannot upload base64 encoded file")}return t.blob?t.blob:t},e.prototype._getFileSize=function(t){return"undefined"!=typeof Blob&&t instanceof Blob?t.size:"undefined"!=typeof Buffer&&Buffer.isBuffer(t)?t.length:void 0},e.prototype._getFileTokens=function(t,e,n,r){return o(this,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/fileTokens",body:{name:t,ACL:n,metaData:r,mime_type:e}})];case 1:return[2,o.sent().body]}}))}))},e.prototype._getFileProvider=function(t){switch(t){case"qiniu":return new yt;case"s3":return new vt(this.app);default:throw new Error("Unsupported file provider: "+t)}},e.prototype._invokeFileCallback=function(t,e){return this.app.request({method:"POST",path:"1.1/fileCallback",body:{token:t,result:e}})},e}(X),gt=function(){function t(t){this.app=t}return t.prototype.class=function(t){switch(t){case"_User":return new ct(this.app);case"_Role":return new lt(this.app);case"_Status":return new dt(this.app);case"_File":return new _t(this.app);default:return new X(this.app,t)}},t.prototype.encode=function(t){return F.encodeObject(t,!0)},t.prototype.decode=function(t){var e=this.app.decode(t);return N(e instanceof D,"Decode failed"),e},t}(),wt=function(){function t(t,e){var n,r=this;this._app=t,this.sid=e.sid,this.hits=e.hits,this.results=null===(n=e.results)||void 0===n?void 0:n.map((function(t){return r._app.decodeObject(t)}))}return t.prototype.next=function(e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:return 0===this.results.length?[2,this]:[4,this._app.request({method:"GET",path:"1.1/search/select",query:{sid:this.sid},options:e})];case 1:return n=r.sent(),[2,new t(this._app,n.body)]}}))}))},t}(),Ct=function(){function t(){this._sortFields=[]}return t.prototype.orderBy=function(t,e,n){var r,o={order:e};return(null==n?void 0:n.mode)&&(o.mode=n.mode),(null==n?void 0:n.missing)&&(o.missing="_"+n.missing),this._sortFields.push(((r={})[t]=o,r)),this},t.prototype.whereNear=function(t,e,n){var o,i=r(r({},n),((o={})[t]={lat:e.latitude,lon:e.longitude},o));return this._sortFields.push({_geo_distance:i}),this},t.prototype.toString=function(){return JSON.stringify(this._sortFields)},t}(),Tt=function(){function t(t,e){this.app=t,this.className=e,this._order=[]}return t.prototype.queryString=function(t){var e=this._clone();return e._q=t,e},t.prototype.skip=function(t){var e=this._clone();return e._skip=t,e},t.prototype.limit=function(t){var e=this._clone();return e._limit=t,e},t.prototype.sid=function(t){var e=this._clone();return e._sid=t,e},t.prototype.fields=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._clone();return n._fields=t,n},t.prototype.highlights=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._clone();return n._highlights=t,n},t.prototype.include=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._clone();return n._include=t,n},t.prototype.find=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request(this._makeRequest(t))];case 1:return e=n.sent(),[2,new wt(this.app,e.body)]}}))}))},t.prototype.orderBy=function(t,e){var n=this._clone();return"desc"===e?n._order.push("-"+t):n._order.push(t),n},t.prototype.sortBy=function(t){var e=this._clone();return e._sort=t.toString(),e},t.prototype._makeRequest=function(t){var e,n={method:"GET",path:"1.1/search/select",query:{q:this._q,skip:this._skip,limit:this._limit,sid:this._sid,clazz:this.className,sort:this._sort},options:t};return this._fields&&(n.query.fields=this._fields.join(",")),this._highlights&&(n.query.highlights=this._highlights.join(",")),this._include&&(n.query.include=this._include.join(",")),this._order.length&&(n.query.order=null===(e=this._order)||void 0===e?void 0:e.join(",")),n},t.prototype._clone=function(){var e=new t(this.app,this.className);return e._q=this._q,e._skip=this._skip,e._limit=this._limit,e._sid=this._sid,e._fields=this._fields,e._highlights=this._highlights,e._sort=this._sort,e._include=this._include,e._order=s(this._order),e},t}(),Ot=function(){function t(t){this.app=t}return t.request=function(e,n){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,(r=new t(e)).refresh(n)];case 1:return o.sent(),[2,r]}}))}))},t.prototype.refresh=function(t){return o(this,void 0,void 0,(function(){var e;return i(this,(function(n){switch(n.label){case 0:return this.validateToken=null,[4,this.app.request({method:"GET",path:"1.1/requestCaptcha",query:{width:null==t?void 0:t.width,height:null==t?void 0:t.height,size:null==t?void 0:t.size,ttl:null==t?void 0:t.ttl},options:t})];case 1:return e=n.sent(),this.token=e.body.captcha_token,this.url=e.body.captcha_url,[2]}}))}))},t.prototype.verify=function(t,e){return o(this,void 0,void 0,(function(){var n;return i(this,(function(r){switch(r.label){case 0:if(!this.token)throw new Error("The captcha token is empty, you should call refresh first");return[4,this.app.request({method:"POST",path:"1.1/verifyCaptcha",body:{captcha_code:t,captcha_token:this.token},options:e})];case 1:return n=r.sent(),this.validateToken=n.body.validate_token,[2,this.validateToken]}}))}))},t.prototype.bind=function(t){this._binder||(this._binder=new kt(this,t)),this._binder.bind()},t.prototype.unbind=function(){this._binder&&this._binder.unbind()},t}(),kt=function(){function t(t,e){this.captcha=t,"string"==typeof e.image?this.image=document.getElementById(e.image):this.image=e.image,"string"==typeof e.textInput?this.input=document.getElementById(e.textInput):this.input=e.textInput,"string"==typeof e.verifyButton?this.button=document.getElementById(e.verifyButton):this.button=e.verifyButton,this.onSuccess=e.success,this.onError=e.error,this.onRefresh=this.refresh.bind(this),this.onVerify=this.verify.bind(this)}return t.prototype.refresh=function(){return o(this,void 0,void 0,(function(){var t;return i(this,(function(e){switch(e.label){case 0:return e.trys.push([0,2,,3]),[4,this.captcha.refresh()];case 1:return e.sent(),this.image.src=this.captcha.url,this.input&&(this.input.value="",this.input.focus()),[3,3];case 2:return t=e.sent(),this.onError&&this.onError(t),[3,3];case 3:return[2]}}))}))},t.prototype.verify=function(){return o(this,void 0,void 0,(function(){var t,e;return i(this,(function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),t=this.input.value,[4,this.captcha.verify(t)];case 1:return n.sent(),this.onSuccess&&this.onSuccess(this.captcha.validateToken),[3,3];case 2:return e=n.sent(),this.onError&&this.onError(e),[3,3];case 3:return[2]}}))}))},t.prototype.bind=function(){this.image&&(this.image.src=this.captcha.url,this.image.addEventListener("click",this.onRefresh)),this.input&&this.button&&this.button.addEventListener("click",this.onVerify)},t.prototype.unbind=function(){this.image&&this.image.removeEventListener("click",this.onRefresh),this.button&&this.button.removeEventListener("click",this.onVerify)},t}(),At=function(){function t(t){this.app=t}return t.prototype.requestSMSCode=function(t,e){return o(this,void 0,void 0,(function(){return i(this,(function(n){switch(n.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/requestSmsCode",body:r(r({},null==e?void 0:e.variables),{mobilePhoneNumber:t,smsType:null==e?void 0:e.smsType,ttl:null==e?void 0:e.ttl,name:null==e?void 0:e.name,op:null==e?void 0:e.op,template:null==e?void 0:e.template,sign:null==e?void 0:e.sign,validate_token:null==e?void 0:e.validateToken}),options:e})];case 1:return n.sent(),[2]}}))}))},t.prototype.verifySMSCode=function(t,e,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/verifySmsCode/"+e,body:{mobilePhoneNumber:t},options:n})];case 1:return r.sent(),[2]}}))}))},t.prototype.run=function(t,e,n){return o(this,void 0,void 0,(function(){return i(this,(function(r){switch(r.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/functions/"+t,body:e,options:n})];case 1:return[2,r.sent().body.result]}}))}))},t.prototype.rpc=function(t,e,n){return o(this,void 0,void 0,(function(){var r;return i(this,(function(o){switch(o.label){case 0:return[4,this.app.request({method:"POST",path:"1.1/call/"+t,body:F.encode(e,!0),options:n})];case 1:return r=o.sent(),[2,this.app.decode(r.body.result)]}}))}))},t}(),Et=function(){function t(t){this.app=t}return t.prototype.send=function(t,e){var n,r,s;return o(this,void 0,void 0,(function(){return i(this,(function(o){switch(o.label){case 0:if((null==e?void 0:e.expirationTime)&&(null==e?void 0:e.expirationInterval))throw new Error("Both expirationTime and expirationInterval cannot be set");return[4,this.app.request({method:"POST",path:"1.1/push",body:{data:t,where:null===(n=null==e?void 0:e.query)||void 0===n?void 0:n.toJSON(),channels:null==e?void 0:e.channels,push_time:null===(r=null==e?void 0:e.pushTime)||void 0===r?void 0:r.toISOString(),expiration_time:null===(s=null==e?void 0:e.expirationTime)||void 0===s?void 0:s.toISOString(),expiration_interval:null==e?void 0:e.expirationInterval,notification_id:null==e?void 0:e.notificationId,req_id:null==e?void 0:e.reqId,prod:null==e?void 0:e.prod,topic:null==e?void 0:e.topic,apns_team_id:null==e?void 0:e.apnsTeamId,flow_control:null==e?void 0:e.flowControl,_notificationChannel:null==e?void 0:e.notificationChannel},options:e})];case 1:return o.sent(),[2]}}))}))},t}(),St=l((function(t,e){var n=h&&h.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.name="AbortError",e}return n(e,t),e}(Error);e.AbortError=r}));const jt=new WeakMap,Pt=new WeakMap;function xt(t){const e=jt.get(t);return console.assert(null!=e,"'this' is expected an Event object, but got",t),e}function qt(t){null==t.passiveListener?t.event.cancelable&&(t.canceled=!0,"function"==typeof t.event.preventDefault&&t.event.preventDefault()):"undefined"!=typeof console&&"function"==typeof console.error&&console.error("Unable to preventDefault inside passive event listener invocation.",t.passiveListener)}function It(t,e){jt.set(this,{eventTarget:t,event:e,eventPhase:2,currentTarget:t,canceled:!1,stopped:!1,immediateStopped:!1,passiveListener:null,timeStamp:e.timeStamp||Date.now()}),Object.defineProperty(this,"isTrusted",{value:!1,enumerable:!0});const n=Object.keys(e);for(let t=0;t<n.length;++t){const e=n[t];e in this||Object.defineProperty(this,e,Nt(e))}}function Nt(t){return{get(){return xt(this).event[t]},set(e){xt(this).event[t]=e},configurable:!0,enumerable:!0}}function Rt(t){return{value(){const e=xt(this).event;return e[t].apply(e,arguments)},configurable:!0,enumerable:!0}}function Ut(t){if(null==t||t===Object.prototype)return It;let e=Pt.get(t);return null==e&&(e=function(t,e){const n=Object.keys(e);if(0===n.length)return t;function r(e,n){t.call(this,e,n)}r.prototype=Object.create(t.prototype,{constructor:{value:r,configurable:!0,writable:!0}});for(let o=0;o<n.length;++o){const i=n[o];if(!(i in t.prototype)){const t="function"==typeof Object.getOwnPropertyDescriptor(e,i).value;Object.defineProperty(r.prototype,i,t?Rt(i):Nt(i))}}return r}(Ut(Object.getPrototypeOf(t)),t),Pt.set(t,e)),e}function Lt(t){return xt(t).immediateStopped}function Dt(t,e){xt(t).passiveListener=e}It.prototype={get type(){return xt(this).event.type},get target(){return xt(this).eventTarget},get currentTarget(){return xt(this).currentTarget},composedPath(){const t=xt(this).currentTarget;return null==t?[]:[t]},get NONE(){return 0},get CAPTURING_PHASE(){return 1},get AT_TARGET(){return 2},get BUBBLING_PHASE(){return 3},get eventPhase(){return xt(this).eventPhase},stopPropagation(){const t=xt(this);t.stopped=!0,"function"==typeof t.event.stopPropagation&&t.event.stopPropagation()},stopImmediatePropagation(){const t=xt(this);t.stopped=!0,t.immediateStopped=!0,"function"==typeof t.event.stopImmediatePropagation&&t.event.stopImmediatePropagation()},get bubbles(){return Boolean(xt(this).event.bubbles)},get cancelable(){return Boolean(xt(this).event.cancelable)},preventDefault(){qt(xt(this))},get defaultPrevented(){return xt(this).canceled},get composed(){return Boolean(xt(this).event.composed)},get timeStamp(){return xt(this).timeStamp},get srcElement(){return xt(this).eventTarget},get cancelBubble(){return xt(this).stopped},set cancelBubble(t){if(!t)return;const e=xt(this);e.stopped=!0,"boolean"==typeof e.event.cancelBubble&&(e.event.cancelBubble=!0)},get returnValue(){return!xt(this).canceled},set returnValue(t){t||qt(xt(this))},initEvent(){}},Object.defineProperty(It.prototype,"constructor",{value:It,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.Event&&(Object.setPrototypeOf(It.prototype,window.Event.prototype),Pt.set(window.Event.prototype,It));const Ft=new WeakMap;function Mt(t){return null!==t&&"object"==typeof t}function Bt(t){const e=Ft.get(t);if(null==e)throw new TypeError("'this' is expected an EventTarget object, but got another value.");return e}function $t(t,e){Object.defineProperty(t,"on"+e,function(t){return{get(){let e=Bt(this).get(t);for(;null!=e;){if(3===e.listenerType)return e.listener;e=e.next}return null},set(e){"function"==typeof e||Mt(e)||(e=null);const n=Bt(this);let r=null,o=n.get(t);for(;null!=o;)3===o.listenerType?null!==r?r.next=o.next:null!==o.next?n.set(t,o.next):n.delete(t):r=o,o=o.next;if(null!==e){const o={listener:e,listenerType:3,passive:!1,once:!1,next:null};null===r?n.set(t,o):r.next=o}},configurable:!0,enumerable:!0}}(e))}function Wt(t){function e(){zt.call(this)}e.prototype=Object.create(zt.prototype,{constructor:{value:e,configurable:!0,writable:!0}});for(let n=0;n<t.length;++n)$t(e.prototype,t[n]);return e}function zt(){if(!(this instanceof zt)){if(1===arguments.length&&Array.isArray(arguments[0]))return Wt(arguments[0]);if(arguments.length>0){const t=new Array(arguments.length);for(let e=0;e<arguments.length;++e)t[e]=arguments[e];return Wt(t)}throw new TypeError("Cannot call a class as a function")}Ft.set(this,new Map)}zt.prototype={addEventListener(t,e,n){if(null==e)return;if("function"!=typeof e&&!Mt(e))throw new TypeError("'listener' should be a function or an object.");const r=Bt(this),o=Mt(n),i=(o?Boolean(n.capture):Boolean(n))?1:2,s={listener:e,listenerType:i,passive:o&&Boolean(n.passive),once:o&&Boolean(n.once),next:null};let a=r.get(t);if(void 0===a)return void r.set(t,s);let u=null;for(;null!=a;){if(a.listener===e&&a.listenerType===i)return;u=a,a=a.next}u.next=s},removeEventListener(t,e,n){if(null==e)return;const r=Bt(this),o=(Mt(n)?Boolean(n.capture):Boolean(n))?1:2;let i=null,s=r.get(t);for(;null!=s;){if(s.listener===e&&s.listenerType===o)return void(null!==i?i.next=s.next:null!==s.next?r.set(t,s.next):r.delete(t));i=s,s=s.next}},dispatchEvent(t){if(null==t||"string"!=typeof t.type)throw new TypeError('"event.type" should be a string.');const e=Bt(this),n=t.type;let r=e.get(n);if(null==r)return!0;const o=function(t,e){return new(Ut(Object.getPrototypeOf(e)))(t,e)}(this,t);let i=null;for(;null!=r;){if(r.once?null!==i?i.next=r.next:null!==r.next?e.set(n,r.next):e.delete(n):i=r,Dt(o,r.passive?r.listener:null),"function"==typeof r.listener)try{r.listener.call(this,o)}catch(t){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(t)}else 3!==r.listenerType&&"function"==typeof r.listener.handleEvent&&r.listener.handleEvent(o);if(Lt(o))break;r=r.next}return Dt(o,null),function(t,e){xt(t).eventPhase=e}(o,0),function(t,e){xt(t).currentTarget=e}(o,null),!o.defaultPrevented}},Object.defineProperty(zt.prototype,"constructor",{value:zt,configurable:!0,writable:!0}),"undefined"!=typeof window&&void 0!==window.EventTarget&&Object.setPrototypeOf(zt.prototype,window.EventTarget.prototype);var Kt=Object.freeze({__proto__:null,default:zt,defineEventAttribute:$t,EventTarget:zt}),Jt=l((function(t,e){var n=h&&h.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function r(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(e,"__esModule",{value:!0});var r=function(t){function e(n,r){var o=t.call(this)||this;if(o._readyState=e.CLOSED,!n)throw new TypeError("Failed to construct 'WebSocket': url required");return o._url=n,o._protocol=r,o}return n(e,t),Object.defineProperty(e.prototype,"url",{get:function(){return this._url},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"protocol",{get:function(){return this._protocol},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"readyState",{get:function(){return this._readyState},enumerable:!0,configurable:!0}),e.CONNECTING=0,e.OPEN=1,e.CLOSING=2,e.CLOSED=3,e}(Kt.EventTarget("open","error","message","close"));e.WS=r})),Qt=l((function(t,e){function n(t){for(var n in t)e.hasOwnProperty(n)||(e[n]=t[n])}Object.defineProperty(e,"__esModule",{value:!0}),n(St),n(Jt)})),Gt=l((function(t){function e(t){if(t)return function(t){for(var n in e.prototype)t[n]=e.prototype[n];return t}(t)}t.exports=e,e.prototype.on=e.prototype.addEventListener=function(t,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+t]=this._callbacks["$"+t]||[]).push(e),this},e.prototype.once=function(t,e){function n(){this.off(t,n),e.apply(this,arguments)}return n.fn=e,this.on(t,n),this},e.prototype.off=e.prototype.removeListener=e.prototype.removeAllListeners=e.prototype.removeEventListener=function(t,e){if(this._callbacks=this._callbacks||{},0==arguments.length)return this._callbacks={},this;var n,r=this._callbacks["$"+t];if(!r)return this;if(1==arguments.length)return delete this._callbacks["$"+t],this;for(var o=0;o<r.length;o++)if((n=r[o])===e||n.fn===e){r.splice(o,1);break}return 0===r.length&&delete this._callbacks["$"+t],this},e.prototype.emit=function(t){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),n=this._callbacks["$"+t],r=1;r<arguments.length;r++)e[r-1]=arguments[r];if(n){r=0;for(var o=(n=n.slice(0)).length;r<o;++r)n[r].apply(this,e)}return this},e.prototype.listeners=function(t){return this._callbacks=this._callbacks||{},this._callbacks["$"+t]||[]},e.prototype.hasListeners=function(t){return!!this.listeners(t).length}})),Ht=Zt;Zt.default=Zt,Zt.stable=te,Zt.stableStringify=te;var Xt=[],Vt=[];function Zt(t,e,n){var r;for(!function t(e,n,r,o){var i;if("object"==typeof e&&null!==e){for(i=0;i<r.length;i++)if(r[i]===e){var s=Object.getOwnPropertyDescriptor(o,n);return void(void 0!==s.get?s.configurable?(Object.defineProperty(o,n,{value:"[Circular]"}),Xt.push([o,n,e,s])):Vt.push([e,n]):(o[n]="[Circular]",Xt.push([o,n,e])))}if(r.push(e),Array.isArray(e))for(i=0;i<e.length;i++)t(e[i],i,r,e);else{var a=Object.keys(e);for(i=0;i<a.length;i++){var u=a[i];t(e[u],u,r,e)}}r.pop()}}(t,"",[],void 0),r=0===Vt.length?JSON.stringify(t,e,n):JSON.stringify(t,ee(e),n);0!==Xt.length;){var o=Xt.pop();4===o.length?Object.defineProperty(o[0],o[1],o[3]):o[0][o[1]]=o[2]}return r}function Yt(t,e){return t<e?-1:t>e?1:0}function te(t,e,n){var r,o=function t(e,n,r,o){var i;if("object"==typeof e&&null!==e){for(i=0;i<r.length;i++)if(r[i]===e){var s=Object.getOwnPropertyDescriptor(o,n);return void(void 0!==s.get?s.configurable?(Object.defineProperty(o,n,{value:"[Circular]"}),Xt.push([o,n,e,s])):Vt.push([e,n]):(o[n]="[Circular]",Xt.push([o,n,e])))}if("function"==typeof e.toJSON)return;if(r.push(e),Array.isArray(e))for(i=0;i<e.length;i++)t(e[i],i,r,e);else{var a={},u=Object.keys(e).sort(Yt);for(i=0;i<u.length;i++){var c=u[i];t(e[c],c,r,e),a[c]=e[c]}if(void 0===o)return a;Xt.push([o,n,e]),o[n]=a}r.pop()}}(t,"",[],void 0)||t;for(r=0===Vt.length?JSON.stringify(o,e,n):JSON.stringify(o,ee(e),n);0!==Xt.length;){var i=Xt.pop();4===i.length?Object.defineProperty(i[0],i[1],i[3]):i[0][i[1]]=i[2]}return r}function ee(t){return t=void 0!==t?t:function(t,e){return e},function(e,n){if(Vt.length>0)for(var r=0;r<Vt.length;r++){var o=Vt[r];if(o[1]===e&&o[0]===n){n="[Circular]",Vt.splice(r,1);break}}return t.call(this,e,n)}}function ne(t){return(ne="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var re=function(t){return null!==t&&"object"===ne(t)};function oe(t){return(oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var ie=se;function se(t){if(t)return function(t){for(var e in se.prototype)Object.prototype.hasOwnProperty.call(se.prototype,e)&&(t[e]=se.prototype[e]);return t}(t)}se.prototype.clearTimeout=function(){return clearTimeout(this._timer),clearTimeout(this._responseTimeoutTimer),clearTimeout(this._uploadTimeoutTimer),delete this._timer,delete this._responseTimeoutTimer,delete this._uploadTimeoutTimer,this},se.prototype.parse=function(t){return this._parser=t,this},se.prototype.responseType=function(t){return this._responseType=t,this},se.prototype.serialize=function(t){return this._serializer=t,this},se.prototype.timeout=function(t){if(!t||"object"!==oe(t))return this._timeout=t,this._responseTimeout=0,this._uploadTimeout=0,this;for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))switch(e){case"deadline":this._timeout=t.deadline;break;case"response":this._responseTimeout=t.response;break;case"upload":this._uploadTimeout=t.upload;break;default:console.warn("Unknown timeout option",e)}return this},se.prototype.retry=function(t,e){return 0!==arguments.length&&!0!==t||(t=1),t<=0&&(t=0),this._maxRetries=t,this._retries=0,this._retryCallback=e,this};var ae=["ECONNRESET","ETIMEDOUT","EADDRINFO","ESOCKETTIMEDOUT"];se.prototype._shouldRetry=function(t,e){if(!this._maxRetries||this._retries++>=this._maxRetries)return!1;if(this._retryCallback)try{var n=this._retryCallback(t,e);if(!0===n)return!0;if(!1===n)return!1}catch(t){console.error(t)}if(e&&e.status&&e.status>=500&&501!==e.status)return!0;if(t){if(t.code&&ae.includes(t.code))return!0;if(t.timeout&&"ECONNABORTED"===t.code)return!0;if(t.crossDomain)return!0}return!1},se.prototype._retry=function(){return this.clearTimeout(),this.req&&(this.req=null,this.req=this.request()),this._aborted=!1,this.timedout=!1,this.timedoutError=null,this._end()},se.prototype.then=function(t,e){var n=this;if(!this._fullfilledPromise){var r=this;this._endCalled&&console.warn("Warning: superagent request was sent twice, because both .end() and .then() were called. Never call .end() if you use promises"),this._fullfilledPromise=new Promise((function(t,e){r.on("abort",(function(){if(!(n._maxRetries&&n._maxRetries>n._retries))if(n.timedout&&n.timedoutError)e(n.timedoutError);else{var t=new Error("Aborted");t.code="ABORTED",t.status=n.status,t.method=n.method,t.url=n.url,e(t)}})),r.end((function(n,r){n?e(n):t(r)}))}))}return this._fullfilledPromise.then(t,e)},se.prototype.catch=function(t){return this.then(void 0,t)},se.prototype.use=function(t){return t(this),this},se.prototype.ok=function(t){if("function"!=typeof t)throw new Error("Callback required");return this._okCallback=t,this},se.prototype._isResponseOK=function(t){return!!t&&(this._okCallback?this._okCallback(t):t.status>=200&&t.status<300)},se.prototype.get=function(t){return this._header[t.toLowerCase()]},se.prototype.getHeader=se.prototype.get,se.prototype.set=function(t,e){if(re(t)){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&this.set(n,t[n]);return this}return this._header[t.toLowerCase()]=e,this.header[t]=e,this},se.prototype.unset=function(t){return delete this._header[t.toLowerCase()],delete this.header[t],this},se.prototype.field=function(t,e){if(null==t)throw new Error(".field(name, val) name can not be empty");if(this._data)throw new Error(".field() can't be used if .send() is used. Please use only .send() or only .field() & .attach()");if(re(t)){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&this.field(n,t[n]);return this}if(Array.isArray(e)){for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&this.field(t,e[r]);return this}if(null==e)throw new Error(".field(name, val) val can not be empty");return"boolean"==typeof e&&(e=String(e)),this._getFormData().append(t,e),this},se.prototype.abort=function(){return this._aborted||(this._aborted=!0,this.xhr&&this.xhr.abort(),this.req&&this.req.abort(),this.clearTimeout(),this.emit("abort")),this},se.prototype._auth=function(t,e,n,r){switch(n.type){case"basic":this.set("Authorization","Basic ".concat(r("".concat(t,":").concat(e))));break;case"auto":this.username=t,this.password=e;break;case"bearer":this.set("Authorization","Bearer ".concat(t))}return this},se.prototype.withCredentials=function(t){return void 0===t&&(t=!0),this._withCredentials=t,this},se.prototype.redirects=function(t){return this._maxRedirects=t,this},se.prototype.maxResponseSize=function(t){if("number"!=typeof t)throw new TypeError("Invalid argument");return this._maxResponseSize=t,this},se.prototype.toJSON=function(){return{method:this.method,url:this.url,data:this._data,headers:this._header}},se.prototype.send=function(t){var e=re(t),n=this._header["content-type"];if(this._formData)throw new Error(".send() can't be used if .attach() or .field() is used. Please use only .send() or only .field() & .attach()");if(e&&!this._data)Array.isArray(t)?this._data=[]:this._isHost(t)||(this._data={});else if(t&&this._data&&this._isHost(this._data))throw new Error("Can't merge these send calls");if(e&&re(this._data))for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(this._data[r]=t[r]);else"string"==typeof t?(n||this.type("form"),n=this._header["content-type"],this._data="application/x-www-form-urlencoded"===n?this._data?"".concat(this._data,"&").concat(t):t:(this._data||"")+t):this._data=t;return!e||this._isHost(t)||n||this.type("json"),this},se.prototype.sortQuery=function(t){return this._sort=void 0===t||t,this},se.prototype._finalizeQueryString=function(){var t=this._query.join("&");if(t&&(this.url+=(this.url.includes("?")?"&":"?")+t),this._query.length=0,this._sort){var e=this.url.indexOf("?");if(e>=0){var n=this.url.slice(e+1).split("&");"function"==typeof this._sort?n.sort(this._sort):n.sort(),this.url=this.url.slice(0,e)+"?"+n.join("&")}}},se.prototype._appendQueryString=function(){console.warn("Unsupported")},se.prototype._timeoutError=function(t,e,n){if(!this._aborted){var r=new Error("".concat(t+e,"ms exceeded"));r.timeout=e,r.code="ECONNABORTED",r.errno=n,this.timedout=!0,this.timedoutError=r,this.abort(),this.callback(r)}},se.prototype._setTimeouts=function(){var t=this;this._timeout&&!this._timer&&(this._timer=setTimeout((function(){t._timeoutError("Timeout of ",t._timeout,"ETIME")}),this._timeout)),this._responseTimeout&&!this._responseTimeoutTimer&&(this._responseTimeoutTimer=setTimeout((function(){t._timeoutError("Response timeout of ",t._responseTimeout,"ETIMEDOUT")}),this._responseTimeout))};var ue=function(t){return t.split(/ *; */).shift()},ce=function(t){return t.split(/ *; */).reduce((function(t,e){var n=e.split(/ *= */),r=n.shift(),o=n.shift();return r&&o&&(t[r]=o),t}),{})},he=function(t){return t.split(/ *, */).reduce((function(t,e){var n=e.split(/ *; */),r=n[0].slice(1,-1);return t[n[1].split(/ *= */)[1].slice(1,-1)]=r,t}),{})},pe=le;function le(t){if(t)return function(t){for(var e in le.prototype)Object.prototype.hasOwnProperty.call(le.prototype,e)&&(t[e]=le.prototype[e]);return t}(t)}function de(t){return function(t){if(Array.isArray(t))return fe(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return fe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return fe(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fe(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function ye(){this._defaults=[]}le.prototype.get=function(t){return this.header[t.toLowerCase()]},le.prototype._setHeaderProperties=function(t){var e=t["content-type"]||"";this.type=ue(e);var n=ce(e);for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(this[r]=n[r]);this.links={};try{t.link&&(this.links=he(t.link))}catch(t){}},le.prototype._setStatusProperties=function(t){var e=t/100|0;this.statusCode=t,this.status=this.statusCode,this.statusType=e,this.info=1===e,this.ok=2===e,this.redirect=3===e,this.clientError=4===e,this.serverError=5===e,this.error=(4===e||5===e)&&this.toError(),this.created=201===t,this.accepted=202===t,this.noContent=204===t,this.badRequest=400===t,this.unauthorized=401===t,this.notAcceptable=406===t,this.forbidden=403===t,this.notFound=404===t,this.unprocessableEntity=422===t},["use","on","once","set","query","type","accept","auth","withCredentials","sortQuery","retry","ok","redirects","timeout","buffer","serialize","parse","ca","key","pfx","cert","disableTLSCerts"].forEach((function(t){ye.prototype[t]=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return this._defaults.push({fn:t,args:n}),this}})),ye.prototype._setDefaults=function(t){this._defaults.forEach((function(e){t[e.fn].apply(t,de(e.args))}))};var ve=ye,be=l((function(t,e){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var r;function o(){}"undefined"!=typeof window?r=window:"undefined"==typeof self?(console.warn("Using browser-only version of superagent in non-browser environment"),r=void 0):r=self,t.exports=function(t,n){return"function"==typeof n?new e.Request("GET",t).end(n):1===arguments.length?new e.Request("GET",t):new e.Request(t,n)};var i=e=t.exports;e.Request=l,i.getXHR=function(){if(r.XMLHttpRequest&&(!r.location||"file:"!==r.location.protocol||!r.ActiveXObject))return new XMLHttpRequest;try{return new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(t){}try{return new ActiveXObject("Msxml2.XMLHTTP")}catch(t){}throw new Error("Browser-only version of superagent could not find XHR")};var s="".trim?function(t){return t.trim()}:function(t){return t.replace(/(^\s*|\s*$)/g,"")};function a(t){if(!re(t))return t;var e=[];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&u(e,n,t[n]);return e.join("&")}function u(t,e,n){if(void 0!==n)if(null!==n)if(Array.isArray(n))n.forEach((function(n){u(t,e,n)}));else if(re(n))for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&u(t,"".concat(e,"[").concat(r,"]"),n[r]);else t.push(encodeURI(e)+"="+encodeURIComponent(n));else t.push(encodeURI(e))}function c(t){for(var e,n,r={},o=t.split("&"),i=0,s=o.length;i<s;++i)-1===(n=(e=o[i]).indexOf("="))?r[decodeURIComponent(e)]="":r[decodeURIComponent(e.slice(0,n))]=decodeURIComponent(e.slice(n+1));return r}function h(t){return/[/+]json($|[^-\w])/.test(t)}function p(t){this.req=t,this.xhr=this.req.xhr,this.text="HEAD"!==this.req.method&&(""===this.xhr.responseType||"text"===this.xhr.responseType)||void 0===this.xhr.responseType?this.xhr.responseText:null,this.statusText=this.req.xhr.statusText;var e=this.xhr.status;1223===e&&(e=204),this._setStatusProperties(e),this.headers=function(t){for(var e,n,r,o,i=t.split(/\r?\n/),a={},u=0,c=i.length;u<c;++u)-1!==(e=(n=i[u]).indexOf(":"))&&(r=n.slice(0,e).toLowerCase(),o=s(n.slice(e+1)),a[r]=o);return a}(this.xhr.getAllResponseHeaders()),this.header=this.headers,this.header["content-type"]=this.xhr.getResponseHeader("content-type"),this._setHeaderProperties(this.header),null===this.text&&t._responseType?this.body=this.xhr.response:this.body="HEAD"===this.req.method?null:this._parseBody(this.text?this.text:this.xhr.response)}function l(t,e){var n=this;this._query=this._query||[],this.method=t,this.url=e,this.header={},this._header={},this.on("end",(function(){var t,e=null,r=null;try{r=new p(n)}catch(t){return(e=new Error("Parser is unable to parse the response")).parse=!0,e.original=t,n.xhr?(e.rawResponse=void 0===n.xhr.responseType?n.xhr.responseText:n.xhr.response,e.status=n.xhr.status?n.xhr.status:null,e.statusCode=e.status):(e.rawResponse=null,e.status=null),n.callback(e)}n.emit("response",r);try{n._isResponseOK(r)||(t=new Error(r.statusText||r.text||"Unsuccessful HTTP response"))}catch(e){t=e}t?(t.original=e,t.response=r,t.status=r.status,n.callback(t,r)):n.callback(null,r)}))}function d(t,e,n){var r=i("DELETE",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r}i.serializeObject=a,i.parseString=c,i.types={html:"text/html",json:"application/json",xml:"text/xml",urlencoded:"application/x-www-form-urlencoded",form:"application/x-www-form-urlencoded","form-data":"application/x-www-form-urlencoded"},i.serialize={"application/x-www-form-urlencoded":a,"application/json":Ht},i.parse={"application/x-www-form-urlencoded":c,"application/json":JSON.parse},pe(p.prototype),p.prototype._parseBody=function(t){var e=i.parse[this.type];return this.req._parser?this.req._parser(this,t):(!e&&h(this.type)&&(e=i.parse["application/json"]),e&&t&&(t.length>0||t instanceof Object)?e(t):null)},p.prototype.toError=function(){var t=this.req,e=t.method,n=t.url,r="cannot ".concat(e," ").concat(n," (").concat(this.status,")"),o=new Error(r);return o.status=this.status,o.method=e,o.url=n,o},i.Response=p,Gt(l.prototype),ie(l.prototype),l.prototype.type=function(t){return this.set("Content-Type",i.types[t]||t),this},l.prototype.accept=function(t){return this.set("Accept",i.types[t]||t),this},l.prototype.auth=function(t,e,r){1===arguments.length&&(e=""),"object"===n(e)&&null!==e&&(r=e,e=""),r||(r={type:"function"==typeof btoa?"basic":"auto"});var o=function(t){if("function"==typeof btoa)return btoa(t);throw new Error("Cannot use basic auth, btoa is not a function")};return this._auth(t,e,r,o)},l.prototype.query=function(t){return"string"!=typeof t&&(t=a(t)),t&&this._query.push(t),this},l.prototype.attach=function(t,e,n){if(e){if(this._data)throw new Error("superagent can't mix .send() and .attach()");this._getFormData().append(t,e,n||e.name)}return this},l.prototype._getFormData=function(){return this._formData||(this._formData=new r.FormData),this._formData},l.prototype.callback=function(t,e){if(this._shouldRetry(t,e))return this._retry();var n=this._callback;this.clearTimeout(),t&&(this._maxRetries&&(t.retries=this._retries-1),this.emit("error",t)),n(t,e)},l.prototype.crossDomainError=function(){var t=new Error("Request has been terminated\nPossible causes: the network is offline, Origin is not allowed by Access-Control-Allow-Origin, the page is being unloaded, etc.");t.crossDomain=!0,t.status=this.status,t.method=this.method,t.url=this.url,this.callback(t)},l.prototype.agent=function(){return console.warn("This is not supported in browser version of superagent"),this},l.prototype.ca=l.prototype.agent,l.prototype.buffer=l.prototype.ca,l.prototype.write=function(){throw new Error("Streaming is not supported in browser version of superagent")},l.prototype.pipe=l.prototype.write,l.prototype._isHost=function(t){return t&&"object"===n(t)&&!Array.isArray(t)&&"[object Object]"!==Object.prototype.toString.call(t)},l.prototype.end=function(t){this._endCalled&&console.warn("Warning: .end() was called twice. This is not supported in superagent"),this._endCalled=!0,this._callback=t||o,this._finalizeQueryString(),this._end()},l.prototype._setUploadTimeout=function(){var t=this;this._uploadTimeout&&!this._uploadTimeoutTimer&&(this._uploadTimeoutTimer=setTimeout((function(){t._timeoutError("Upload timeout of ",t._uploadTimeout,"ETIMEDOUT")}),this._uploadTimeout))},l.prototype._end=function(){if(this._aborted)return this.callback(new Error("The request has been aborted even before .end() was called"));var t=this;this.xhr=i.getXHR();var e=this.xhr,n=this._formData||this._data;this._setTimeouts(),e.onreadystatechange=function(){var n=e.readyState;if(n>=2&&t._responseTimeoutTimer&&clearTimeout(t._responseTimeoutTimer),4===n){var r;try{r=e.status}catch(t){r=0}if(!r){if(t.timedout||t._aborted)return;return t.crossDomainError()}t.emit("end")}};var r=function(e,n){n.total>0&&(n.percent=n.loaded/n.total*100,100===n.percent&&clearTimeout(t._uploadTimeoutTimer)),n.direction=e,t.emit("progress",n)};if(this.hasListeners("progress"))try{e.addEventListener("progress",r.bind(null,"download")),e.upload&&e.upload.addEventListener("progress",r.bind(null,"upload"))}catch(t){}e.upload&&this._setUploadTimeout();try{this.username&&this.password?e.open(this.method,this.url,!0,this.username,this.password):e.open(this.method,this.url,!0)}catch(t){return this.callback(t)}if(this._withCredentials&&(e.withCredentials=!0),!this._formData&&"GET"!==this.method&&"HEAD"!==this.method&&"string"!=typeof n&&!this._isHost(n)){var o=this._header["content-type"],s=this._serializer||i.serialize[o?o.split(";")[0]:""];!s&&h(o)&&(s=i.serialize["application/json"]),s&&(n=s(n))}for(var a in this.header)null!==this.header[a]&&Object.prototype.hasOwnProperty.call(this.header,a)&&e.setRequestHeader(a,this.header[a]);this._responseType&&(e.responseType=this._responseType),this.emit("request",this),e.send(void 0===n?null:n)},i.agent=function(){return new ve},["GET","POST","OPTIONS","PATCH","PUT","DELETE"].forEach((function(t){ve.prototype[t.toLowerCase()]=function(e,n){var r=new i.Request(t,e);return this._setDefaults(r),n&&r.end(n),r}})),ve.prototype.del=ve.prototype.delete,i.get=function(t,e,n){var r=i("GET",t);return"function"==typeof e&&(n=e,e=null),e&&r.query(e),n&&r.end(n),r},i.head=function(t,e,n){var r=i("HEAD",t);return"function"==typeof e&&(n=e,e=null),e&&r.query(e),n&&r.end(n),r},i.options=function(t,e,n){var r=i("OPTIONS",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},i.del=d,i.delete=d,i.patch=function(t,e,n){var r=i("PATCH",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},i.post=function(t,e,n){var r=i("POST",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r},i.put=function(t,e,n){var r=i("PUT",t);return"function"==typeof e&&(n=e,e=null),e&&r.send(e),n&&r.end(n),r}})),me=l((function(t,e){var n=h&&h.__awaiter||function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{u(r.next(t))}catch(t){i(t)}}function a(t){try{u(r.throw(t))}catch(t){i(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,a)}u((r=r.apply(t,e||[])).next())}))},r=h&&h.__generator||function(t,e){var n,r,o,i,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function a(i){return function(a){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return s.label++,{value:i[1],done:!1};case 5:s.label++,r=i[1],i=[0];continue;case 7:i=s.ops.pop(),s.trys.pop();continue;default:if(!(o=s.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){s=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){s.label=i[1];break}if(6===i[0]&&s.label<o[1]){s.label=o[1],o=i;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(i);break}o[2]&&s.ops.pop(),s.trys.pop();continue}i=e.call(t,s)}catch(t){i=[6,t],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,a])}}};function o(t){return{ok:t.ok,status:t.status,headers:t.header,data:t.body}}Object.defineProperty(e,"__esModule",{value:!0}),e.request=function(t,e){var i=this;void 0===e&&(e={});var s=e.method,a=void 0===s?"GET":s,u=e.data,c=e.headers,h=e.onprogress,p=e.signal;if(null==p?void 0:p.aborted)return Promise.reject(new Qt.AbortError("Request aborted"));var l=be(a,t);return c&&l.set(c),h&&l.on("progress",h),new Promise((function(t,e){return n(i,void 0,void 0,(function(){var n,i,s;return r(this,(function(r){switch(r.label){case 0:p&&p.addEventListener("abort",(function(){e(new Qt.AbortError("Request aborted")),l.abort()})),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,l.send(u)];case 2:return n=r.sent(),t(o(n)),[3,4];case 3:return i=r.sent(),(s=i).response?t(o(s.response)):e(i),[3,4];case 4:return[2]}}))}))}))},e.upload=function(t,e,i){void 0===i&&(i={});var s=i.method,a=void 0===s?"POST":s,u=i.data,c=i.headers,h=i.onprogress,p=i.signal;if(null==p?void 0:p.aborted)return Promise.reject(new Qt.AbortError("Request aborted"));var l=be(a,t).attach(e.field,e.data,e.name);return u&&l.field(u),c&&l.set(c),h&&l.on("progress",h),new Promise((function(t,e){return n(void 0,void 0,void 0,(function(){var n,i,s;return r(this,(function(r){switch(r.label){case 0:p&&p.addEventListener("abort",(function(){e(new Qt.AbortError("Request aborted")),l.abort()})),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,l];case 2:return n=r.sent(),t(o(n)),[3,4];case 3:return i=r.sent(),(s=i).response?t(o(s.response)):e(i),[3,4];case 4:return[2]}}))}))}))}})),_e=l((function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.request=me.request,e.upload=me.upload,e.storage=window.localStorage,e.WebSocket=window.WebSocket,e.platformInfo={name:"Browser"}})),ge=p(_e);u(Object.freeze(Object.assign(Object.create(null),_e,{default:ge}))),t.ACL=R,t.App=$,t.Captcha=Ot,t.Cloud=At,t.GeoPoint=W,t.Op=V,t.Push=Et,t.Query=z,t.SearchQuery=Tt,t.SearchSortBuilder=Ct,t.Storage=gt,t.debug=T,t.setAdapters=u,t.use=function(t){t.load($)},Object.defineProperty(t,"__esModule",{value:!0})}));
